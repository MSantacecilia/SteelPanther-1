{% extends "navbar.html" %}




{% block content %}


    <div class="form-style-10" style="margin-top: 10%;">

    <h1>Delete Questions</h1>
    <p><select id="category_select">
        <option disabled=true>Select Category</option>
        {% for category in categories %}
        <option value="{{category.id}}">{{ category.name }}</option>
        {% endfor %}
        </select>
    </p>
    <table  class="table table-light" id="questions_table" >
         <thead class="thead-dark">

    </table>
    </div>

    <div>
        <h1>Transform a file demo</h1>

                <form action="/transform" method="post" enctype="multipart/form-data">
                    <input type="file" name="data_file" />
                    <input type="submit" />
                </form>
    </div>


    <script>
        let category_select = document.getElementById("category_select");
        let questions_table = document.getElementById("questions_table");

        window.onload = function() {
            loadTable();
        };

        category_select.onchange = function() {
            loadTable();
        }

         function loadTable(){
            category_id = category_select.value;
            fetch('/filter_questions/' + category_id).then(function(response){
                response.json().then(function(data){
                    let questionHTML = '<tr><th>Question</th><th></th><th></th></tr>';
                    for(let question of data.questions){
                        questionHTML += '<tr><td>'+ question.name +'</td>'
                        questionHTML += '<td><button class="btn btn-info btn-sm" onclick="editQuestion('+ question.id +')">Edit</button></td>'
                        questionHTML += '<td><button class="btn btn-info btn-sm" onclick="deleteQuestion('+ question.id +')">Delete</button></td></tr>'
                    }

                    questions_table.innerHTML = questionHTML;
                });
            });
         }

         function editQuestion(questionId) {
            var updatedQuestion = prompt("Please update the question:");
            if (updatedQuestion == null || updatedQuestion == "") {
                if (confirm("Delete the question?")) {
                    fetch('/delete_question/' +questionId).then(function(response){
                        response.json().then(function(data){
                            loadTable();
                        });
                    });
                }
            } else {
                fetch('/update_question/' +questionId+ '/' +updatedQuestion).then(function(response){
                    response.json().then(function(data){
                        loadTable();
                    });
                });
            }
         }

         function deleteQuestion(questionId){
            if (confirm("Delete the question?")) {
                    fetch('/delete_question/' +questionId).then(function(response){
                        response.json().then(function(data){
                            if(data.result == "success"){
                                loadTable();
                            }
                            else{
                                alert("Unable to delete question !");
                            }
                        });
                    });
             }
         }

    </script>

{% endblock %}